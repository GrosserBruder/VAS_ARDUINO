<h1 align="center">ОТЧЁТ <br> о результатах работы за октябрь 2020 года</h1>
 
#### За отчётный период было выполнено следующее:
#### 1. Анализ необходимых функций программно-аппаратного комплекса для расширения функционала и подбор элементной базы в соответствии с функционалом.

За отчётный период мною был проведён анализ необходимых функций по теме научного исследования программно-аппаратного комплекса 
автоматизированной системы мониторинга и управления состоянием удалённых объектов в части аппаратного модуля сбора, анализа и оповещения о его состоянии.

В ходе анализа было решено усовершенствовать разработанную систему путём добавления следующих функций на удалённых объектах:
1.	Управление электропитанием.
2.	Оповещение о несанкционированном доступе.
3.	Управление и оповещение о состоянии задымлённости. 
4.	Видеонаблюдение.
5.	Разработка базы данных для постоянного хранения всех показателей.
6.	Разработка web-страницы для отображения показателей.

После перечисления всех функций, необходимых для масштабирования системы в целом, мною был произведён подбор элементной базы в соответствии с этим функционалом.

Выбор элементной базы является важной частью аппаратной разработки любой системы, в состав которой входят электронные устройства, 
так как от правильного выбора зависит как общая стоимость, так и гарантированное выполнение своих функций в условиях. 
При выборе элементной базы для разрабатываемой установки необходимо учитывать следующие требования:
1.	Обеспечение минимальной потребляемой мощности. 
2.	Обеспечение быстродействия.
3.	Обеспечение заданных габаритов.
4.	Обеспечение работы аппаратного комплекса в условиях, описанных в ГОСТ и СанПин нормах для конкретного типа помещения.
5.	Обеспечение наименьшей стоимости.
6.	Обеспечение простоты ремонта.
7.	Обеспечение простоты замены отдельных компонентов (при невозможности ремонта).

В качестве центрального узла системы используется микроконтроллер семейства Arduino. Он используется как в качестве управляющего, 
так и управляемого устройства, отличающихся только моделью самой платы с разным количеством пинов (входов) на них. 
Для программно-аппаратного комплекса были подобраны для элементной базы взаимозаменяемые платы Arduino:
1.	Управляющее устройство – Arduino Nano.
2.	Управляемые устройства: Arduino UNO, Arduino WAVGAT UNO R3, Arduino Nano.

Главное различия между платами Arduino, используемых в системе – это размеры плат (Рис. 1).
<p align="center">
  <img src="https://github.com/NekitJavaDev/VAS_ARDUINO/blob/master/src/img/october/1_Arduino_WAVGAT_Arduino_UNO_%D0%B8_Arduino_Nano.jpg"/>
</p>
<p align="center">Рисунок 1 — Arduino WAVGAT, Arduino UNO и Arduino Nano</p>

У платы Arduino WAVGAT такие же характеристики, как и у Arduino UNO. Остальные отличия между платами можно увидеть, сравнив их основные характеристики. 
Они представлены в таблице 1, таблице 2.
<p align="right">Таблица 1.</p>
<p align="center">Характеристики платы Arduino UNO</p>

| Наименование | Значение  |
| :----------------- | :-------------: |
| Микроконтроллер  | ATmega328P  |
| Рабочее напряжение  | 5 В  |
| Входное напряжение (рекомендуемое)  | 7-12 В  |
| Входное напряжение (предельное)  | 6-20 В |
| Цифровые входы/выходы  | 14 (6 из которых могут работать так же, как выходы ШИМ) |
| Аналоговые входы  | 6  |
| Постоянный ток через вход/выход  | 20 мА  |
| Постоянный ток для вывода 3,3 В  | 50 мА  |
| Флеш-память  | 32 Кбайт, из которых 5 Кбайт используются для загрузчика  |
| ОЗУ  | 2 Кбайт  |
| EEPROM  | 1 Кбайт  |
| Тактовая частота  | 16 МГц  |

<p align="right">Таблица 2.</p>
<p align="center">Характеристики платы Arduino Nano</p>

| Наименование | Значение  |
| :----------------- | :-------------: |
| Микроконтроллер  | ATmega328  |
| Рабочее напряжение  | 5 В  |
| Входное напряжение (рекомендуемое)  | 7-12 В  |
| Входное напряжение (предельное)  | 6-20 В |
| Цифровые входы/выходы  | 14 (6 из которых могут работать так же, как выходы ШИМ) |
| Аналоговые входы  | 8 |
| Постоянный ток через вход/выход  | 40 мА  |
| Постоянный ток для вывода 3,3 В  | 500 мА  |
| Флеш-память  | 32 Кбайт, из которых 2 Кбайт используются для загрузчика  |
| ОЗУ  | 2 Кбайт  |
| EEPROM  | 1 Кбайт  |
| Тактовая частота  | 16 МГц  |

Для обмена данными между устройствами, их питания и подключения других модулей к системе также необходимо закупить 
резисторы различного сопротивления, провода «мама-папа», «папа-папа», «мама-мама», Breadboard для тестирования модулей без пайки проводов, 
различные дополнительные модули и датчики (задымленности, геркон и другие от компании «Амперка»). 
Все перечисленные составляющие есть в наличии на сайте <http://amperka.ru/> (Рис. 2).
<p align="center">
  <img src="https://github.com/NekitJavaDev/VAS_ARDUINO/blob/master/src/img/october/2_%D1%80%D0%B0%D0%B7%D0%B4%D0%B5%D0%BB%D1%8B_%D1%81%D0%B0%D0%B9%D1%82%D0%B0_%D1%81_%D0%BA%D0%BE%D0%BC%D0%BF%D0%BE%D0%BD%D0%B5%D0%BD%D1%82%D0%B0%D0%BC%D0%B8_%D0%B4%D0%BB%D1%8F_Arduino.jpg"/>
</p>
<p align="center">Рисунок 2 — Разделы сайта с компонентами для Arduino</p>

#### 2. Расширение элементной базы для совершенствования аппаратного модуля в части управления электропитания объектов.

Для расширения элементной базы в части управления электропитания объектов для аппаратной части был выбран модуль Voltage Sensor. 
Он представляет собой аналоговый датчик для измерения напряжения в сети постоянного тока до 25 вольт. 
Данный модуль представляет собой простой делитель напряжения (Рис. 3).
<p align="center">
  <img src="https://github.com/NekitJavaDev/VAS_ARDUINO/blob/master/src/img/october/3_%D0%B2%D0%BD%D0%B5%D1%88%D0%BD%D0%B8%D0%B9_%D0%B2%D0%B8%D0%B4_%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8F_Arduino_Voltage_Sensor.jpg"/>
</p>
<p align="center">Рисунок 3 — Внешний вид модуля Arduino Voltage <Sensor></Sensor></p>

В нем уже предустановлены резисторы сопротивлением 30 кОм и 7,5 кОм. Любая модель из всевозможных разновидностей плат Arduino 
имеет максимальную границу входного напряжения – 5 Вольт. Для измерения входного напряжения до 25 вольт отлично подойдёт Voltage Sensor, 
который позволяет без пайки измерять подобные устройства. На модуле реализован резистивный делитель напряжения с коэффициентом 1:5, 
то есть на входе модуля напряжение может изменяться от 0 до 25 вольт, а на выходе оно будет пропорционально распределено от 0 до 5 вольт. 
Это означает, что по шкале значений 0-1024 единица результата считывания АЦП будет равна 0.02 В. 

Области применения: измерение напряжения бортовой сети автомобиля, паяльной станции, нагревательного элемента паяльника и другое. 
В рамках разрабатываемого программно-аппаратного комплекса модуль будет использоваться для измерения заряда батареи (аккумулятора), 
которая питается от сети 220 вольт. Низкий уровень заряда батареи означает отключение основного источника питания, 
так как система автоматически переходит на резервный источник питания от аккумулятора. 

Модуль Voltage Sensor с одной стороны снабжён винтовыми клеммниками для подключения к измеряемому участку цепи. 
С противоположной стороны имеет три вывода для передачи в Arduino (Рис. 4):
1.	S – Сигнальный вывод подключается к аналоговому пину (входу)
2.	«+» – Плюсовой вывод не задействован 
3.	«–» – Минусовой вывод подключается к GND (минусовой пин)
<p align="center">
  <img src="https://github.com/NekitJavaDev/VAS_ARDUINO/blob/master/src/img/october/4_%D1%81%D1%85%D0%B5%D0%BC%D0%B0_%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D1%8F_Voltage_Sensor_%D0%BA_Arduino_%D0%B8_%D0%BA_%D0%B8%D0%B7%D0%BC%D0%B5%D1%80%D1%8F%D0%B5%D0%BC%D0%BE%D0%BC%D1%83_%D1%83%D1%87%D0%B0%D1%81%D1%82%D0%BA%D1%83_%D1%86%D0%B5%D0%BF%D0%B8.jpg"/>
</p>
<p align="center">Рисунок 4 — Схема подключения Voltage Sensor к Arduino и к измеряемому участку цепи </p>

#### 3. Разработка, тестирование и отладка программного обеспечения для разрабатываемого модуля.

После подключения Voltage Sensor к Arduino остаётся реализовать программную часть для данного модуля и убедиться в её правильной работоспособности. 
Так как все управляемые устройства должны быть взаимозаменяемыми, необходимо разработать универсальную прошивку, работающую на всех устройствах одинаково. 
Первым делом подключаем сигнальный вывод модуля к аналоговому входу 4 (пин A4) на плате. 
В прошивке указываем препроцессору об объявлении переменной VOLTAGE_PIN:
```C++
    #define VOLTAGE_PIN A4
```
Добавляем ещё 2 константы со значениями сопротивления внутренних резисторов:
```C++
    #define R1_VOLTAGE 30000.0
    #define R2_VOLTAGE 7500.0
```
Далее объявляем переменные U_REF (опорное напряжение) и Uin (вычисление максимума входного напряжения):
```C++
    #define U_REF = 5 //or simply HIGH (5V)
    float Uin = U_REF * ((R1_VOLTAGE + R2_VOLTAGE) / R2_VOLTAGE);
```
В функцию setup() добавляем, что аналоговый пин A4 работает на вход, то есть будет считывать показания:


```C++  
    void setup() {
    ------------------------------------------------------------
    pinMode(VOLTAGE_PIN, INPUT);
    ------------------------------------------------------------
    }
```
Следующим этапом следует добавить считывание показаний, и преобразование показаний в Вольты в функцию loop():
```C++  
    ------------------------------------------------------------
    sensor.requestTemperatures();  
    float temperature = sensor.getTempCByIndex(0);	
    float voltage = (analogRead(VOLTAGEPIN) * Uin) / 1024.0 /10;	
    delay(50);
    ------------------------------------------------------------
```
Для проверки правильности преобразования показаний, необходимо добавить поле voltage в отправляемую по RS485 объявленную структуру данных:
```C++
    struct SEND_DATA_STRUCTURE {
        int ID;
      	float temp;
      	float voltage;
    };
```
Завершающим этапом отправляем показания, считанные из цепи и записанные в переменную voltage, предварительно записав значение в саму структуру данных:
```C++
    if (ETrx.receiveData()) {    
            txdata.ID = RS485ID;
            txdata.temp = temperature;
            txdata.voltage = voltage;
        
            digitalWrite(DIR, HIGH); // включаем передачу
            delay(50);
            ETtx.sendData(); //отправляем на управляющее устройство
            delay(50);
            digitalWrite(DIR, LOW);
    }
```
Для тестирования работоспособности модуля, нужно подключить обычную солевую батарейку «AA», которая на выходе должна давать напряжение от 1,1V (в разряженном состоянии) до 1,5V:
1.	GND – к «-» батарейки
2.	VCC – к «+» батарейки  

и добавить 2 строчки кода в функции loop() сразу после считывания показаний и записи в переменную voltage:
```C++
    Serial.print("voltage = ");
    Serial.println(voltage);
```
Модуль успешно прошёл тестирование и была доказана работоспособность и корректность показаний (Рис. 5) (Рис. 6).
<p align="center">
  <img src="https://github.com/NekitJavaDev/VAS_ARDUINO/blob/master/src/img/october/5_%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80_Serial_(%D0%BF%D0%BE%D1%81%D0%BB%D0%B5%D0%B4%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D0%B3%D0%BE)_%D0%BF%D0%BE%D1%80%D1%82%D0%B0.jpg"/>
</p>
<p align="center">Рисунок 5 — Монитор Serial (последовательного) порта</p>

<p align="center">
  <img src="https://github.com/NekitJavaDev/VAS_ARDUINO/blob/master/src/img/october/6_%D0%B0%D0%BF%D0%BF%D0%B0%D1%80%D0%B0%D1%82%D0%BD%D0%BE%D0%B5_%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8F_%D0%B8_%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B2%D1%85%D0%BE%D0%B4%D0%BD%D0%BE%D0%B3%D0%BE_%D0%BD%D0%B0%D0%BF%D1%80%D1%8F%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F.jpg"/>
</p>
<p align="center">Рисунок 6 — Аппаратное подключение модуля и тестирование входного напряжения</p>